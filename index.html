<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talent Scout AI - Platinum Strategic Edition</title>
    
    <!-- Fonts: Oswald -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Oswald', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            orange: '#FF9800',
                            teal: '#009688',
                            blue: '#5C6BC0',
                            navy: '#1a237e',
                            gold: '#FFD700', // New luxury accent
                        }
                    }
                }
            }
        }
    </script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof pdfjsLib !== 'undefined') {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            }
        });
    </script>
    
    <style>
        body { background-color: #f0f2f5; }
        
        /* Custom Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FF9800;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #e0e0e0; }
        ::-webkit-scrollbar-thumb { background: #1a237e; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #FF9800; }

        /* Gauge Animation */
        .gauge-circle {
            transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.3s ease-out; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: all 0.2s ease-in; }

        /* Print Styling for Report Export */
        @media print {
            body { height: auto; overflow: visible; background: white; }
            nav, .left-panel, .footer-action, .placeholder-state, .print-hidden { display: none !important; }
            .right-panel { width: 100% !important; overflow: visible !important; }
            .result-container { display: block !important; overflow: visible !important; padding: 0 !important; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden font-sans relative">

    <!-- Guide Modal -->
    <div id="guideModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-brand-navy/90 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-2xl rounded-lg shadow-2xl overflow-hidden transform transition-all border border-brand-gold/30">
            <div class="bg-brand-navy p-6 flex justify-between items-center relative overflow-hidden">
                <div class="absolute inset-0 bg-brand-blue/10"></div>
                <h3 class="text-white text-xl font-bold uppercase tracking-wider relative z-10"><i class="fa-solid fa-key text-brand-orange mr-2"></i> Kích hoạt Hệ thống</h3>
                <button onclick="toggleGuide()" class="text-white/70 hover:text-white transition relative z-10"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <div class="p-8">
                <div class="space-y-6">
                    <div class="flex gap-4 group">
                        <div class="w-10 h-10 rounded-full bg-brand-navy text-white flex items-center justify-center font-bold text-lg shrink-0 group-hover:bg-brand-orange transition-colors">1</div>
                        <div>
                            <h4 class="font-bold text-brand-navy text-lg uppercase">Truy cập Google AI Studio</h4>
                            <p class="text-gray-600 font-light mt-1">Truy cập <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-brand-orange hover:underline font-medium">aistudio.google.com</a> & đăng nhập.</p>
                        </div>
                    </div>
                    <div class="flex gap-4 group">
                        <div class="w-10 h-10 rounded-full bg-brand-navy text-white flex items-center justify-center font-bold text-lg shrink-0 group-hover:bg-brand-orange transition-colors">2</div>
                        <div>
                            <h4 class="font-bold text-brand-navy text-lg uppercase">Tạo API Key</h4>
                            <p class="text-gray-600 font-light mt-1">Nhấn nút <span class="bg-gray-100 px-2 py-0.5 rounded text-sm font-bold border border-gray-300">Create API key</span> màu xanh.</p>
                        </div>
                    </div>
                    <div class="flex gap-4 group">
                        <div class="w-10 h-10 rounded-full bg-brand-navy text-white flex items-center justify-center font-bold text-lg shrink-0 group-hover:bg-brand-orange transition-colors">3</div>
                        <div>
                            <h4 class="font-bold text-brand-navy text-lg uppercase">Kích hoạt</h4>
                            <p class="text-gray-600 font-light mt-1">Copy mã <code>AIzaSy...</code> và dán vào thanh công cụ phía trên.</p>
                        </div>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-100 flex justify-end">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="bg-brand-orange hover:bg-orange-600 text-white px-6 py-2 rounded font-bold uppercase tracking-wider transition shadow-lg mr-3 flex items-center gap-2">
                        Lấy Key Ngay <i class="fa-solid fa-external-link-alt text-sm"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="bg-brand-navy text-white px-6 py-4 flex justify-between items-center shrink-0 shadow-lg z-30 border-b border-brand-blue/30 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-full bg-gradient-to-l from-brand-blue/20 to-transparent pointer-events-none"></div>
        <div class="flex items-center gap-4 relative z-10">
            <div class="bg-white text-brand-navy w-12 h-12 rounded-lg flex items-center justify-center shadow-[0_0_15px_rgba(255,255,255,0.3)] transform hover:rotate-12 transition-transform duration-300">
                <i class="fa-solid fa-chess-queen text-2xl text-brand-navy"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold tracking-widest uppercase">Talent Strategy <span class="text-brand-orange">AI</span></h1>
                <p class="text-[10px] font-bold text-brand-teal tracking-[0.3em] uppercase">Platinum Edition</p>
            </div>
        </div>
        
        <div class="flex items-center bg-brand-navy/80 rounded-full px-5 py-2 border border-brand-blue/50 focus-within:ring-2 focus-within:ring-brand-orange transition-all w-full max-w-lg mx-6 shadow-inner backdrop-blur-md">
            <i class="fa-solid fa-fingerprint text-brand-teal mr-3 text-lg"></i>
            <input type="password" id="apiKey" 
                class="bg-transparent border-none outline-none text-sm w-full text-white placeholder-gray-400 font-light tracking-wide"
                placeholder="NHẬP MÃ ĐỊNH DANH (API KEY)...">
            <button onclick="toggleGuide()" class="text-brand-orange hover:text-white transition-colors ml-2 animate-pulse" title="Hướng dẫn">
                <i class="fa-solid fa-circle-question text-lg"></i>
            </button>
        </div>
        
        <div class="flex gap-3">
             <button onclick="window.print()" class="text-sm font-bold text-white/80 hover:text-white uppercase tracking-wider px-4 py-1.5 border border-white/20 hover:border-white rounded transition">
                <i class="fa-solid fa-print mr-2"></i> Report
            </button>
        </div>
    </nav>

    <!-- Main Workspace -->
    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- Left Panel: Strategic Input -->
        <div class="left-panel w-1/3 min-w-[400px] bg-white border-r border-gray-200 flex flex-col shadow-2xl z-20">
            <div class="bg-gray-50 px-6 py-5 border-b border-gray-200">
                <h2 class="text-brand-navy font-bold text-lg uppercase flex items-center gap-2 tracking-wide">
                    <i class="fa-solid fa-database text-brand-teal"></i> Dữ liệu Chiến lược
                </h2>
                <p class="text-xs text-gray-500 font-light mt-1">Cung cấp bối cảnh để AI phân tích chuyên sâu</p>
            </div>

            <div class="p-6 overflow-y-auto flex-1 space-y-8 custom-scrollbar bg-white">
                
                <!-- JD Section -->
                <div class="space-y-3 group">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-[0.1em] group-hover:text-brand-navy transition-colors">
                            <i class="fa-solid fa-crosshairs mr-1"></i> Mục tiêu (JD)
                        </label>
                        <button onclick="fillSampleJD()" class="text-[10px] text-brand-teal border border-brand-teal px-2 py-0.5 rounded hover:bg-brand-teal hover:text-white transition uppercase font-bold">Mẫu Thử</button>
                    </div>
                    <div class="relative group-hover:shadow-lg transition-shadow rounded-lg">
                        <textarea id="jdInput" class="w-full h-40 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:bg-white focus:border-brand-navy focus:ring-1 focus:ring-brand-navy outline-none transition resize-none placeholder-gray-400 leading-relaxed font-light" placeholder="Dán mô tả công việc (Job Description) vào đây..."></textarea>
                    </div>
                </div>

                <!-- CV Section -->
                <div class="space-y-3 flex-1 flex flex-col group">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-[0.1em] group-hover:text-brand-navy transition-colors">
                            <i class="fa-solid fa-user-astronaut mr-1"></i> Hồ sơ Ứng viên (CV)
                        </label>
                        <div class="flex gap-2">
                            <input type="file" id="fileUpload" class="hidden" accept=".pdf,.docx,.txt">
                            <button onclick="document.getElementById('fileUpload').click()" class="text-[10px] bg-brand-navy text-white px-3 py-1 rounded hover:bg-brand-blue transition uppercase font-bold shadow-sm flex items-center gap-2">
                                <i class="fa-solid fa-cloud-arrow-up"></i> Upload
                            </button>
                            <button onclick="fillSampleCV()" class="text-[10px] text-brand-teal border border-brand-teal px-2 py-0.5 rounded hover:bg-brand-teal hover:text-white transition uppercase font-bold">Mẫu Thử</button>
                        </div>
                    </div>
                    <div class="relative flex-1 min-h-[250px] group-hover:shadow-lg transition-shadow rounded-lg">
                        <textarea id="cvInput" class="w-full h-full p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:bg-white focus:border-brand-navy focus:ring-1 focus:ring-brand-navy outline-none transition resize-none placeholder-gray-400 leading-relaxed font-light" placeholder="Nội dung CV sẽ hiển thị tại đây..."></textarea>
                        
                        <!-- File Loader Overlay -->
                        <div id="fileLoader" class="hidden absolute inset-0 bg-white/95 z-10 flex flex-col items-center justify-center rounded-lg border border-brand-teal/20 backdrop-blur-sm">
                            <div class="loader mb-3"></div>
                            <span class="text-xs font-bold text-brand-navy animate-pulse tracking-widest" id="fileNameDisplay">ĐANG GIẢI MÃ DỮ LIỆU...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Action -->
            <div class="p-6 border-t border-gray-200 bg-gray-50 footer-action">
                <button onclick="analyzeCV()" id="analyzeBtn" class="w-full bg-gradient-to-r from-brand-navy to-brand-blue hover:from-brand-orange hover:to-orange-600 text-white font-bold text-lg py-4 rounded shadow-xl hover:shadow-2xl transition-all transform hover:-translate-y-1 active:translate-y-0 flex justify-center items-center gap-3 uppercase tracking-[0.1em]">
                    <i class="fa-solid fa-microchip"></i>
                    <span>Kích hoạt Phân tích</span>
                </button>
            </div>
        </div>

        <!-- Right Panel: Strategic Dashboard -->
        <div class="right-panel flex-1 bg-gray-100 relative overflow-hidden flex flex-col">
            
            <!-- Empty State -->
            <div id="placeholderState" class="placeholder-state absolute inset-0 flex flex-col items-center justify-center text-gray-400 opacity-60">
                <div class="w-32 h-32 border-4 border-gray-300 rounded-full flex items-center justify-center mb-6">
                    <i class="fa-solid fa-chart-pie text-6xl text-gray-300"></i>
                </div>
                <h3 class="text-3xl font-bold text-brand-navy uppercase tracking-widest">Trung tâm Chỉ huy</h3>
                <p class="text-sm font-light mt-3 tracking-wide">Sẵn sàng tiếp nhận dữ liệu chiến lược</p>
            </div>

            <!-- Loading State -->
            <div id="loadingOverlay" class="hidden absolute inset-0 bg-white/90 backdrop-blur-md z-50 flex flex-col items-center justify-center">
                <div class="relative">
                    <div class="w-24 h-24 border-t-4 border-b-4 border-brand-navy rounded-full animate-spin"></div>
                    <div class="w-16 h-16 border-l-4 border-r-4 border-brand-orange rounded-full animate-spin absolute top-4 left-4" style="animation-direction: reverse; animation-duration: 2s;"></div>
                    <i class="fa-solid fa-brain absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-brand-teal text-2xl animate-pulse"></i>
                </div>
                <h3 class="text-2xl font-bold text-brand-navy uppercase tracking-wide mt-8">Đang Thẩm định Chuyên sâu</h3>
                <p class="text-gray-500 font-light mt-2 text-sm tracking-widest typing-effect">Phân tích đa chiều • Khớp nối dữ liệu • Dự báo tác động</p>
            </div>

            <!-- Content Container -->
            <div id="resultContainer" class="result-container hidden flex-1 overflow-y-auto p-10 custom-scrollbar scroll-smooth">
                
                <!-- Candidate Header Card (Luxury Style) -->
                <div class="bg-white rounded-lg shadow-lg border-t-4 border-brand-orange p-8 mb-8 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-brand-navy/5 to-transparent rounded-bl-full -mr-16 -mt-16 pointer-events-none"></div>
                    
                    <div class="flex flex-col md:flex-row gap-8 items-start justify-between relative z-10">
                        <div class="flex-1">
                            <div class="flex items-center gap-4 mb-3">
                                <h2 id="rName" class="text-5xl font-bold text-brand-navy uppercase tracking-tight">Candidate Name</h2>
                            </div>
                            <div class="flex items-center gap-3 mb-4">
                                <span id="rSeniority" class="px-3 py-1 text-xs font-bold bg-brand-navy text-white uppercase tracking-wider rounded-sm">Senior Level</span>
                                <span id="rArchetype" class="px-3 py-1 text-xs font-bold border border-brand-teal text-brand-teal uppercase tracking-wider rounded-sm">The Visionary</span>
                            </div>
                            <p id="rOneLiner" class="text-gray-600 text-xl font-light italic border-l-4 border-brand-orange pl-6 py-2">"Một câu tóm tắt đắt giá về ứng viên..."</p>
                        </div>
                        
                        <div class="flex items-center gap-10">
                             <!-- Gauge Chart -->
                             <div class="flex flex-col items-center">
                                <div class="relative w-32 h-32">
                                    <svg class="w-full h-full transform -rotate-90 drop-shadow-xl">
                                        <circle cx="64" cy="64" r="58" stroke="#f1f5f9" stroke-width="8" fill="transparent" />
                                        <circle id="scoreCircle" cx="64" cy="64" r="58" stroke="#009688" stroke-width="8" fill="transparent" class="gauge-circle" stroke-dasharray="364.4" stroke-dashoffset="364.4" stroke-linecap="round" />
                                    </svg>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                                        <span id="rScore" class="text-4xl font-bold text-brand-navy">--</span>
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Match Score</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Decision Box -->
                            <div class="text-right">
                                <div class="text-xs text-gray-400 uppercase font-bold mb-2 tracking-widest">Khuyến nghị</div>
                                <div id="rStatus" class="px-8 py-3 rounded font-bold text-white bg-gray-400 shadow-lg text-2xl uppercase tracking-widest inline-block">
                                    ---
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategic Visualization Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    
                    <!-- Radar Chart Container -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-sm border border-gray-100 flex flex-col items-center justify-center relative">
                        <h4 class="absolute top-4 left-6 text-xs font-bold text-gray-400 uppercase tracking-widest">Bản đồ Năng lực</h4>
                        <div class="w-full h-[300px] flex items-center justify-center">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <!-- Keyword Ecosystem -->
                    <div class="lg:col-span-2 bg-white p-8 rounded-lg shadow-sm border border-gray-100 flex flex-col">
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6">Hệ sinh thái Từ khóa (Skill Gap Analysis)</h4>
                        
                        <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Matched -->
                            <div>
                                <div class="flex items-center gap-2 mb-4 text-brand-teal">
                                    <i class="fa-solid fa-link"></i>
                                    <span class="font-bold uppercase text-sm">Điểm Khớp (Matched)</span>
                                </div>
                                <div id="matchedKeywords" class="flex flex-wrap gap-2 content-start">
                                    <!-- Dynamic Tags -->
                                </div>
                            </div>
                            
                            <!-- Missing -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                                <div class="flex items-center gap-2 mb-4 text-brand-orange">
                                    <i class="fa-solid fa-link-slash"></i>
                                    <span class="font-bold uppercase text-sm">Điểm Khuyết (Missing)</span>
                                </div>
                                <div id="missingKeywords" class="flex flex-wrap gap-2 content-start">
                                    <!-- Dynamic Tags -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Deep Dive Analysis (2 Columns) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Strengths -->
                    <div class="bg-white p-8 rounded-lg shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div class="absolute top-0 left-0 w-full h-1 bg-brand-teal"></div>
                        <h3 class="font-bold text-2xl text-brand-navy mb-6 flex items-center gap-3 uppercase">
                            <i class="fa-solid fa-gem text-brand-teal text-xl"></i> Lợi thế Cạnh tranh
                        </h3>
                        <ul id="rStrengths" class="space-y-4"></ul>
                    </div>
                    
                    <!-- Weaknesses & Red Flags -->
                    <div class="bg-white p-8 rounded-lg shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div class="absolute top-0 left-0 w-full h-1 bg-brand-orange"></div>
                        <h3 class="font-bold text-2xl text-brand-navy mb-6 flex items-center gap-3 uppercase">
                            <i class="fa-solid fa-shield-halved text-brand-orange text-xl"></i> Rủi ro & Thách thức
                        </h3>
                        <ul id="rWeaknesses" class="space-y-4"></ul>
                        
                        <!-- Red Flags Zone -->
                        <div id="redFlagsContainer" class="hidden mt-6 p-5 bg-red-50 border-l-4 border-red-500">
                            <h4 class="text-sm font-bold text-red-800 uppercase mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-triangle-exclamation animate-pulse"></i> Cảnh báo Đỏ
                            </h4>
                            <ul id="rRedFlags" class="space-y-2 text-sm text-red-800 font-medium ml-4 list-disc marker:text-red-500"></ul>
                        </div>
                    </div>
                </div>

                <!-- Executive Insight -->
                <div class="bg-brand-navy text-white p-10 rounded-lg shadow-xl mb-8 relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 text-[150px] text-white/5 font-serif font-bold italic leading-none">"</div>
                    <h3 class="font-bold text-sm text-brand-orange mb-4 uppercase tracking-[0.2em] flex items-center gap-2">
                        <span class="w-8 h-0.5 bg-brand-orange"></span> Insight Chuyên gia
                    </h3>
                    <p id="rReasoning" class="text-gray-100 leading-relaxed text-justify font-light text-xl tracking-wide relative z-10"></p>
                </div>

                <!-- Interview Guide -->
                <div class="bg-white p-8 rounded-lg shadow-sm border border-gray-200 mb-8 print-hidden">
                    <h3 class="font-bold text-xl text-center text-brand-navy uppercase tracking-widest mb-8">
                        <span class="border-b-2 border-brand-orange pb-2">Hướng dẫn Phỏng vấn Chiến lược</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div>
                            <div class="flex items-center gap-3 mb-4">
                                <span class="bg-brand-navy text-white w-6 h-6 rounded flex items-center justify-center text-xs font-bold">Q</span>
                                <span class="text-sm font-bold text-brand-navy uppercase tracking-wider">Thẩm định Chuyên môn</span>
                            </div>
                            <ul id="rTechQuestions" class="space-y-4"></ul>
                        </div>
                        <div>
                            <div class="flex items-center gap-3 mb-4">
                                <span class="bg-brand-teal text-white w-6 h-6 rounded flex items-center justify-center text-xs font-bold">Q</span>
                                <span class="text-sm font-bold text-brand-teal uppercase tracking-wider">Thẩm định Tư duy</span>
                            </div>
                            <ul id="rBehaviorQuestions" class="space-y-4"></ul>
                        </div>
                    </div>
                </div>

            </div>
            
            <!-- Strategic Footer -->
            <footer class="bg-brand-navy text-white py-4 px-6 text-center border-t border-brand-blue z-20 shrink-0">
                <p class="text-[10px] font-light tracking-[0.3em] uppercase opacity-70">
                    Rosie Đào Hạnh Giang <span class="text-brand-orange mx-2">•</span> CEO Build Talents
                </p>
            </footer>
        </div>
    </div>

    <script>
        // --- CHART INSTANCE ---
        let radarChartInstance = null;

        // --- DATA SAMPLES ---
        const sampleJD = `Vị trí: Strategic Growth Director (B2B SaaS)
Mức lương: $5000 - $8000
Bối cảnh:
Build Talents đang tìm kiếm một nhà lãnh đạo tư duy chiến lược để mở rộng thị phần tại Đông Nam Á.

Trách nhiệm cốt lõi:
- Xây dựng chiến lược Go-to-Market toàn diện cho dòng sản phẩm Enterprise.
- Dẫn dắt đội ngũ Sales & Marketing (20 nhân sự) đạt mục tiêu tăng trưởng 200% ARR.
- Thiết lập quan hệ đối tác chiến lược với các tập đoàn công nghệ Tier 1.
- Phân tích dữ liệu thị trường để định vị lại thương hiệu.

Yêu cầu năng lực:
- 8+ năm kinh nghiệm trong mảng B2B Sales/Growth tại các công ty công nghệ.
- Tư duy dữ liệu (Data-driven mindset) cực mạnh.
- Kỹ năng Leadership xuất sắc, đã từng quản lý team >10 người.
- Tiếng Anh lưu loát, có khả năng diễn thuyết trước công chúng.
- Tư duy khởi nghiệp (Entrepreneurial spirit), chịu được áp lực cao.`;

        const sampleCV = `Trần Minh Tuấn
Email: tuan.tran@growth.co | Tel: 0988xxxxxx

HỒ SƠ NĂNG LỰC
Chuyên gia Tăng trưởng với 10 năm kinh nghiệm thực chiến. Chuyên môn sâu về mở rộng thị trường B2B và xây dựng đội ngũ hiệu suất cao. Đã từng dẫn dắt 2 startup đạt vòng gọi vốn Series B.

THÀNH TỰU NỔI BẬT:
1. Head of Growth @ TechFlow (2020 - Nay)
- Tăng ARR từ $1M lên $5M trong 24 tháng thông qua chiến lược Inbound Marketing mới.
- Xây dựng đội ngũ Sales từ 3 lên 25 người, tỉ lệ giữ chân nhân sự đạt 90%.
- Ký kết thành công hợp đồng đối tác độc quyền với Viettel và FPT.

2. Sales Manager @ Cloudify (2016 - 2020)
- Đạt danh hiệu "Top Performer" 3 năm liên tiếp.
- Mở rộng thị trường sang Indonesia và Thái Lan, đóng góp 30% tổng doanh thu công ty.
- Thiết kế quy trình Sales Training giảm thời gian onboarding từ 2 tháng xuống 2 tuần.

KỸ NĂNG:
- Strategic Planning, B2B Sales, CRM (Salesforce/HubSpot).
- Leadership, Public Speaking, Data Analysis (SQL, Tableau).

HỌC VẤN: MBA - RMIT University.`;

        // --- GLOBAL SELECTORS ---
        const fileInput = document.getElementById('fileUpload');
        const cvTextArea = document.getElementById('cvInput');
        const jdTextArea = document.getElementById('jdInput');
        
        function fillSampleJD() { jdTextArea.value = sampleJD; }
        function fillSampleCV() { cvTextArea.value = sampleCV; document.getElementById('fileNameDisplay').textContent = ""; }

        function toggleGuide() {
            const modal = document.getElementById('guideModal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                modal.querySelector('div').classList.remove('modal-exit', 'modal-exit-active');
                modal.querySelector('div').classList.add('modal-enter', 'modal-enter-active');
                setTimeout(() => modal.querySelector('div').classList.remove('modal-enter', 'modal-enter-active'), 300);
            } else {
                modal.querySelector('div').classList.add('modal-exit', 'modal-exit-active');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.querySelector('div').classList.remove('modal-exit', 'modal-exit-active');
                }, 200);
            }
        }

        // --- FILE PROCESSING ---
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if(!file) return;

            const loader = document.getElementById('fileLoader');
            const fileName = document.getElementById('fileNameDisplay');
            
            loader.classList.remove('hidden');
            fileName.textContent = `ĐANG GIẢI MÃ: ${file.name.toUpperCase()}...`;

            try {
                let text = "";
                if(file.type === "application/pdf") {
                    text = await extractPDF(file);
                } else if(file.type.includes("wordprocessing")) {
                    text = await extractDocx(file);
                } else {
                    text = await file.text();
                }
                cvTextArea.value = text;
                fileName.textContent = file.name.toUpperCase();
            } catch(err) {
                alert("Lỗi đọc file: " + err.message);
                loader.classList.add('hidden');
            } finally {
                loader.classList.add('hidden');
                fileInput.value = '';
            }
        });

        async function extractPDF(file) {
            if (typeof pdfjsLib === 'undefined') throw new Error("PDF Library chưa sẵn sàng.");
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = "";
            for(let i=1; i<=pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + "\n";
            }
            return text;
        }

        async function extractDocx(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            return result.value;
        }

        // --- AI ANALYSIS LOGIC ---
        async function analyzeCV() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const jd = jdTextArea.value.trim();
            const cv = cvTextArea.value.trim();

            if(!apiKey) { toggleGuide(); return; }
            if(!jd || !cv) { alert("Thiếu dữ liệu JD hoặc CV để phân tích."); return; }

            // UI Transitions
            const loading = document.getElementById('loadingOverlay');
            const placeholder = document.getElementById('placeholderState');
            const resultDiv = document.getElementById('resultContainer');
            const btn = document.getElementById('analyzeBtn');

            loading.classList.remove('hidden');
            placeholder.classList.add('hidden');
            resultDiv.classList.add('hidden');
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> ĐANG PHÂN TÍCH...';

            // --- STRATEGIC PROMPT V2 (PLATINUM) ---
            const systemPrompt = `
            Vai trò: Rosie Đào Hạnh Giang - CEO Build Talents.
            Nhiệm vụ: Phân tích CV ứng viên so với JD để cung cấp báo cáo chiến lược.

            Yêu cầu Output JSON Thuần Túy:
            {
                "candidate_name": "Tên ứng viên",
                "archetype": "Hình mẫu (VD: Chiến binh Tăng trưởng, Nhà Kiến tạo...)",
                "one_liner_summary": "Nhận định đắt giá nhất (1 câu).",
                "seniority_level": "Expert / Senior / Mid / Junior",
                "match_score": 0-100,
                "status": "TUYỂN DỤNG NGAY / CÂN NHẮC / KHÔNG PHÙ HỢP",
                "radar_chart_data": [
                    Điểm (0-100) cho: [Chuyên môn, Lãnh đạo, Văn hóa, Giao tiếp, Tư duy Chiến lược, Tác động Thực tế]
                ],
                "keywords": {
                    "matched": ["Từ khóa 1", "Từ khóa 2"...],
                    "missing": ["Từ khóa thiếu 1", "Từ khóa thiếu 2"...]
                },
                "strengths": ["Điểm mạnh 1", "Điểm mạnh 2"...],
                "weaknesses": ["Điểm yếu 1", "Điểm yếu 2"...],
                "red_flags": ["Rủi ro 1", "Rủi ro 2"...],
                "reasoning": "Phân tích chuyên sâu (3-4 câu).",
                "interview_questions_tech": ["Câu hỏi 1", "Câu hỏi 2"],
                "interview_questions_behavior": ["Câu hỏi 1", "Câu hỏi 2"]
            }
            `;

            const userPrompt = `${systemPrompt}\n\n--- JD ---\n${jd}\n\n--- CV ---\n${cv}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                if(!response.ok) throw new Error("Lỗi kết nối AI");

                const data = await response.json();
                let rawText = data.candidates[0].content.parts[0].text;
                rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                const result = JSON.parse(rawText);

                // --- RENDER UI ---
                
                // 1. Header
                document.getElementById('rName').textContent = result.candidate_name;
                document.getElementById('rSeniority').textContent = result.seniority_level;
                document.getElementById('rArchetype').textContent = result.archetype;
                document.getElementById('rOneLiner').textContent = `"${result.one_liner_summary}"`;
                
                // 2. Main Score Gauge
                const score = result.match_score;
                document.getElementById('rScore').textContent = score;
                // C = 2 * pi * 58 ≈ 364.4
                const offset = 364.4 - (364.4 * score) / 100;
                const circle = document.getElementById('scoreCircle');
                circle.style.strokeDashoffset = 364.4;
                
                let gaugeColor = '#009688'; 
                if (score < 50) gaugeColor = '#b71c1c';
                else if (score < 80) gaugeColor = '#FF9800';
                circle.setAttribute('stroke', gaugeColor);
                setTimeout(() => { circle.style.strokeDashoffset = offset; }, 100);

                // 3. Status
                const statusEl = document.getElementById('rStatus');
                statusEl.textContent = result.status;
                statusEl.className = `px-8 py-3 rounded font-bold text-white shadow-lg text-2xl uppercase tracking-widest inline-block ${
                    result.status.includes("TUYỂN") ? 'bg-brand-teal' : 
                    result.status.includes("KHÔNG") ? 'bg-red-600' : 'bg-brand-orange'
                }`;

                // 4. RADAR CHART (NEW)
                renderRadarChart(result.radar_chart_data);

                // 5. Keyword Ecosystem (NEW)
                renderTags('matchedKeywords', result.keywords.matched, 'bg-brand-teal/10 text-brand-teal border-brand-teal/30');
                renderTags('missingKeywords', result.keywords.missing, 'bg-red-50 text-red-600 border-red-200 dashed-border');

                // 6. Lists
                const createList = (id, items, iconHtml, textColor) => {
                    const ul = document.getElementById(id);
                    ul.innerHTML = '';
                    if(!items) return;
                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.className = `flex items-start gap-3 text-gray-600 leading-relaxed font-light text-lg`;
                        li.innerHTML = `<span class="mt-1 ${textColor}">${iconHtml}</span><span>${item}</span>`;
                        ul.appendChild(li);
                    });
                };

                createList('rStrengths', result.strengths, '<i class="fa-solid fa-check"></i>', 'text-brand-teal');
                createList('rWeaknesses', result.weaknesses, '<i class="fa-solid fa-minus"></i>', 'text-brand-orange');
                createList('rTechQuestions', result.interview_questions_tech, '<i class="fa-solid fa-code"></i>', 'text-brand-navy');
                createList('rBehaviorQuestions', result.interview_questions_behavior, '<i class="fa-regular fa-comment"></i>', 'text-brand-teal');

                // Red Flags
                const rfContainer = document.getElementById('redFlagsContainer');
                if(result.red_flags && result.red_flags.length > 0) {
                    rfContainer.classList.remove('hidden');
                    const rfUl = document.getElementById('rRedFlags');
                    rfUl.innerHTML = '';
                    result.red_flags.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item;
                        rfUl.appendChild(li);
                    });
                } else {
                    rfContainer.classList.add('hidden');
                }

                document.getElementById('rReasoning').textContent = result.reasoning;
                resultDiv.classList.remove('hidden');

            } catch(e) {
                alert("Lỗi: " + e.message);
                console.error(e);
            } finally {
                loading.classList.add('hidden');
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.innerHTML = '<i class="fa-solid fa-microchip"></i> <span>Kích hoạt Phân tích</span>';
            }
        }

        // --- CHART FUNCTION ---
        function renderRadarChart(dataPoints) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            if(radarChartInstance) radarChartInstance.destroy();

            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Chuyên môn', 'Lãnh đạo', 'Văn hóa', 'Giao tiếp', 'Chiến lược', 'Tác động'],
                    datasets: [{
                        label: 'Năng lực Ứng viên',
                        data: dataPoints,
                        fill: true,
                        backgroundColor: 'rgba(0, 150, 136, 0.2)', // Brand Teal transparent
                        borderColor: '#009688',
                        pointBackgroundColor: '#FF9800',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#FF9800'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: {
                                font: { family: 'Oswald', size: 12 },
                                color: '#1a237e'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { backdropColor: 'transparent', stepSize: 20 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function renderTags(id, tags, classes) {
            const container = document.getElementById(id);
            container.innerHTML = '';
            if(!tags) return;
            tags.forEach(tag => {
                const span = document.createElement('span');
                span.className = `px-3 py-1 rounded text-xs font-bold border uppercase tracking-wide ${classes}`;
                span.textContent = tag;
                container.appendChild(span);
            });
        }
    </script>
</body>
</html>